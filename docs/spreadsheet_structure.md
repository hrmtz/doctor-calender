# Drシフト スプレッドシート構造

## 概要

| 項目 | 値 |
|------|-----|
| タイトル | Drシフト |
| スプレッドシートID | `1vuP1qxZX9sXifzbP0Zk40zfFf7eYbFqk727V4wWU3lU` |
| シート数 | 42（月別シフト表 + テスト/コピーシート） |
| 期間 | 2024年7月 ～ 2026年5月 |
| 認証 | サービスアカウント（`secrets/snappy-flash-488807-h4-88e00a722344.json`） |

---

## シート一覧

月別シフト表（命名規則: `YYYY.M月`）。古いシートは「完成」「修正」「のコピー」等のサフィックスが付く場合あり。

**現行シート（2025年以降）**:
- `2026.5月`, `2026.4月`, `2026.3月`, `2026.2月`, `2026.2月  のコピー`, `2026.1月`
- `2025.12月`, `2025.11月`, `2025.10月`, `2025.9月`, `2025.8月`, `2025.7月`, `2025.6月`, `2025.5月`, `2025.4月`, `2025.3月`, `2025.2月`, `2025.1月`

**旧シート（2024年）**:
- `2024.12月 完成`, `2024.12月`, `2024.11月`, `2024.11月 のコピー`
- `2024.10 完成 最新`, `2024.10 完成`, `2024.10`, `2024.9 修正`, `2024.9 完成`, `2024.8 確定`, `2024.8 完成`, `2024.7修正`, `2024.7`

**テスト用シート**: `テスト`, `占部テスト`

---

## 各シートの行構造

| 行インデックス | 内容 | 補足 |
|----------------|------|------|
| 0 (行1) | タイトル | `「YYYY年M月　Drシフト」` が col C(index 2) に配置 |
| 1 (行2) | 空行 or 前月末補填 | 前週土日月の日付が入ることあり（2025年以降の多くのシート） |
| 2 (行3) | 日付（1〜31） | col C(index 2)から開始、最大31列 |
| 3 (行4) | 曜日（月〜日） | col C(index 2)から開始 |
| 4〜 (行5〜) | 医師シフトデータ | グループ別に並ぶ（下記参照） |
| 末尾数行 | 集計行 | 院別Dr人数（日毎のカウント） |

---

## 各シートの列構造

| 列インデックス | 列名 | 内容 | 補足 |
|----------------|------|------|------|
| 0 (A列) | グループ | 医師の所属グループ（銀座/非常勤/池袋/新宿/大阪/福岡/静脈/歯科/産休） | グループ先頭行にのみ値。セルマージあり |
| 1 (B列) | 医師名 | Dr名（例: 鉄Dr, 守屋Dr） | |
| 2〜32 (C〜AG列) | 日付別シフト | 各日のシフト値 | 月によって28〜31列 |
| 33付近 | 集計 | 月間出勤日数（数値） | |
| 34付近 | 備考 | コメント・注記（改行含む場合あり） | |

---

## シフト値の種類

| 値 | 意味 |
|----|------|
| `銀座` | 銀座院勤務 |
| `大阪` | 大阪院勤務 |
| `福岡` | 福岡院勤務 |
| `池袋` | 池袋院勤務 |
| `新宿` | 新宿院勤務 |
| `静脈` | 静脈科勤務 |
| `歯科` | 歯科勤務 |
| `休` | 休日 |
| `希` | 希望休 |
| `有` | 有給休暇 |

---

## 医師グループ一覧（2026年3月時点）

| グループ（col A） | 医師名 |
|------------------|--------|
| 銀座 | 鉄Dr, 守屋Dr, 中村Dr, 小川Dr, 橘Dr |
| 非常勤 | 上木原Dr, 林Dr, 前田Dr, 高梨Dr, 桐渕Dr |
| 池袋 | 北村Dr |
| 新宿 | 王Dr, 新井Dr, 副島Dr |
| 大阪 | 楠本Dr, 山田Dr, 原岡Dr, 井上舞Dr, 佐藤Dr |
| 福岡 | 羽根Dr, 境Dr |
| 静脈 | 佟Dr |
| 歯科 | 佐久間Dr, 矢嶋Dr, 中西Dr |
| 産休 | 沈Dr |

---

## 集計行（各シート末尾）

各日の院別在院Dr人数：
- `銀座院Dr人数`
- `大阪院Dr人数`
- `福岡院Dr人数`
- `池袋院Dr人数`
- `新宿院Dr人数`

---

## データ取得上の注意点

1. **セルマージ**: col A（グループ名）はGoogle Sheets上でセルマージされているが、gspreadで`get_all_values()`を使うと先頭行にのみ値が入り、後続行は空文字になる。グループを医師行に対応させるにはマージ範囲を考慮した処理が必要。

2. **前月末補填列**: 2025年以降のシートは前月末（土日月）がcol C前のカラムに入る場合がある。日付列の開始インデックスが月によって異なる可能性に注意。ただし現状は一貫してcol C(index 2)が1日に対応するよう確認済み（前月末は同じくcol Cの手前に挿入されている）。

3. **行数の違い**: `row_count`（968前後）はシート全体の論理行数。実際のデータ行は36行程度（医師数 + 集計行）。空行が大量にある。

4. **シート名バリエーション**: 最新・確定版は最も新しい命名（「完成」「修正」等なし）のシートを優先して参照すること。

---

## API疎通確認スクリプト

```bash
cd /Users/hrmtz/project/personal/doctor-calender
.venv/bin/python3 scripts/fetch_sheets.py
```

出力: `docs/spreadsheet_structure.json`（全シートの構造データ）
